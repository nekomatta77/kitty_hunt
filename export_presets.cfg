[preset.0]

name="Web"
platform="Web"
runnable=true
dedicated_server=false
custom_features=""
export_filter="all_resources"
include_filter=""
exclude_filter=""
export_path="../../neko-board/games/godot_run/godot_index.html"
patches=PackedStringArray()
patch_delta_encoding=false
patch_delta_compression_level_zstd=19
patch_delta_min_reduction=0.1
patch_delta_include_filters="*"
patch_delta_exclude_filters=""
encryption_include_filters=""
encryption_exclude_filters=""
seed=0
encrypt_pck=false
encrypt_directory=false
script_export_mode=2

[preset.0.options]

custom_template/debug=""
custom_template/release=""
variant/extensions_support=false
variant/thread_support=false
vram_texture_compression/for_desktop=true
vram_texture_compression/for_mobile=false
html/export_icon=true
html/custom_html_shell=""
html/head_include="<script src=\"https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js\"></script>
<script src=\"https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js\"></script>
<script>
// Ð–Ð´ÐµÐ¼, Ð¿Ð¾ÐºÐ° Godot Ð¿Ð¾Ð´Ð½Ð¸Ð¼ÐµÑ‚ Ñ„Ð»Ð°Ð³ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚Ð¸
var fbInterval = setInterval(() => {
    if (window.godotNetworkReady) {
        clearInterval(fbInterval);
        initFirebaseWebRTC();
    }
}, 500);

function initFirebaseWebRTC() {
    var firebaseConfig = {
        apiKey: \"AIzaSyC5E-bN2LNWElo7I4kcCGqcgMvoy8WX4wY\",
        authDomain: \"neko-board.firebaseapp.com\",
        databaseURL: \"https://neko-board-default-rtdb.firebaseio.com\",
        projectId: \"neko-board\"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    var db = firebase.database();

    var urlParams = new URLSearchParams(window.location.search);
    var roomId = urlParams.get('room');
    var userName = urlParams.get('user');

    if (!roomId) return; // Ð˜Ð³Ñ€Ð°ÐµÐ¼ Ð¾Ñ„Ñ„Ð»Ð°Ð¹Ð½

    var roomRef = db.ref('rooms/' + roomId);
    var myId = 1;

    roomRef.once('value', snapshot => {
        const room = snapshot.val();
        if (!room) return;

        if (room.host === userName) {
            // ==========================================
            // Ð¯ Ð¥ÐžÐ¡Ð¢ (ÐžÑ…Ð¾Ñ‚Ð½Ð¸Ðº)
            // ==========================================
            myId = 1; 
            window.godot_start_host(); 
            
            // ðŸ”¥ ÐœÐÐ“Ð˜Ð¯ 1: ÐÐ²Ñ‚Ð¾-ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹ Ð¿Ñ€Ð¸ Ð¿Ð¾Ñ‚ÐµÑ€Ðµ ÑÐ²ÑÐ·Ð¸ ÑÐµÑ€Ð²ÐµÑ€Ð¾Ð¼ Firebase (Ð·Ð°ÐºÑ€Ñ‹Ð»/ÑÐ²ÐµÑ€Ð½ÑƒÐ»)
            roomRef.onDisconnect().remove();

            // ðŸ”¥ ÐœÐÐ“Ð˜Ð¯ 2: ÐœÐ¾Ð¼ÐµÐ½Ñ‚Ð°Ð»ÑŒÐ½Ð¾Ðµ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ, ÐµÑÐ»Ð¸ Ð¸Ð³Ñ€Ð¾Ðº ÑƒÑ…Ð¾Ð´Ð¸Ñ‚ ÑÐ¾ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñ‹
            window.addEventListener('beforeunload', () => {
                roomRef.remove();
            });
            window.addEventListener('pagehide', () => {
                roomRef.remove();
            });
            
            roomRef.child('players').on('child_added', snap => {
                var peerId = snap.key;
                if (peerId != 1) window.godot_create_peer(parseInt(peerId));
            });
            
        } else {
            // ==========================================
            // Ð¯ ÐšÐ›Ð˜Ð•ÐÐ¢ (ÐŸÑ€Ð¾Ð¿)
            // ==========================================
            myId = Math.floor(Math.random() * 90000) + 10000;
            window.godot_start_client(myId); 
            
            var myPlayerRef = roomRef.child('players').child(myId);
            
            // ðŸ”¥ Ð§Ñ‚Ð¾Ð±Ñ‹ Ð² Ð±Ð°Ð·Ðµ Ð½Ðµ Ð¾ÑÑ‚Ð°Ð²Ð°Ð»Ð¾ÑÑŒ \"Ð¿Ñ€Ð¸Ð·Ñ€Ð°ÐºÐ¾Ð²\", ÑƒÐ´Ð°Ð»ÑÐµÐ¼ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° Ð¸Ð· ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹ Ð¿Ñ€Ð¸ ÐµÐ³Ð¾ Ð²Ñ‹Ñ…Ð¾Ð´Ðµ
            myPlayerRef.onDisconnect().remove();
            window.addEventListener('beforeunload', () => {
                myPlayerRef.remove();
            });
            window.addEventListener('pagehide', () => {
                myPlayerRef.remove();
            });
            
            myPlayerRef.set({ name: userName });
        }

        roomRef.child('signals').on('child_added', snap => {
            var sig = snap.val();
            if (sig.to === myId) {
                if (sig.type === 'sdp') window.godot_set_remote_sdp(parseInt(sig.from), sig.sdpType, sig.sdp);
                else if (sig.type === 'ice') window.godot_add_remote_ice(parseInt(sig.from), sig.media, sig.index, sig.name);
            }
        });
    });

    window.sendSDPToFirebase = function(targetId, type, sdp) {
        roomRef.child('signals').push({ from: myId, to: targetId, type: 'sdp', sdpType: type, sdp: sdp });
    };
    window.sendICEToFirebase = function(targetId, media, index, name) {
        roomRef.child('signals').push({ from: myId, to: targetId, type: 'ice', media: media, index: index, name: name });
    };
}
</script>"
html/canvas_resize_policy=2
html/focus_canvas_on_start=true
html/experimental_virtual_keyboard=false
progressive_web_app/enabled=false
progressive_web_app/ensure_cross_origin_isolation_headers=true
progressive_web_app/offline_page=""
progressive_web_app/display=1
progressive_web_app/orientation=0
progressive_web_app/icon_144x144=""
progressive_web_app/icon_180x180=""
progressive_web_app/icon_512x512=""
progressive_web_app/background_color=Color(0, 0, 0, 1)
threads/emscripten_pool_size=8
threads/godot_pool_size=4
